import biosppy
import pyhrv.tools as tools
from pyhrv.hrv import hrv
from opensignalsreader import OpenSignalsReader
import pyhrv
import pyhrv.frequency_domain as fd
import matplotlib.pyplot as plt
import os 
# Load sample ECG signal stored in an OpenSignals file
file = os.path.join(os.path.abspath(os.getcwd()),'SampleECG.txt')
signal = OpenSignalsReader(file).signal('ECG')
# signal_results = hrv(signal=signal)

# Load sample nni series
nni = [0.8846153846153846,0.8538461538461539,0.7615384615384615,0.7384615384615385,0.7307692307692313,0.7307692307692308,0.707692307692307,0.7230769230769232,0.7769230769230777,0.7999999999999998,0.8230769230769237,0.9846153846153847,0.9461538461538446,0.9000000000000004,0.953846153846154,0.9230769230769234,0.9153846153846157,0.884615384615385,0.9538461538461522,0.9307692307692328,0.9307692307692292,0.9384615384615387,0.9000000000000021,0.8230769230769219,0.861538461538462,0.9692307692307693,0.9307692307692292,0.9692307692307693,1.0307692307692307,0.9692307692307693,0.9923076923076941,0.907692307692308,0.8846153846153832,0.9615384615384635,0.9769230769230752,0.9230769230769234,0.9846153846153882,1.0230769230769212,0.9692307692307693,1.0692307692307708,0.9615384615384599,0.9230769230769198,0.8923076923076962,0.8384615384615373,0.7923076923076948,0.8769230769230703,0.9230769230769269,0.815384615384616,0.907692307692308,1.0538461538461519,1.0307692307692307,0.9923076923076906,0.907692307692308,0.9230769230769269,0.9230769230769198,0.8846153846153868,0.9769230769230788,0.9230769230769198,0.8000000000000043,0.8769230769230774,0.9923076923076906,0.9153846153846175,0.946153846153841,1.03846153846154,0.9923076923076906,0.9923076923076977,0.9769230769230717,0.8923076923076962,0.8769230769230774,0.9153846153846104,0.8615384615384585,0.8615384615384727,0.8846153846153726,0.8615384615384727,0.8230769230769255,0.8076923076923066,0.8846153846153726,0.776923076923083,0.8692307692307679,0.8769230769230774,0.776923076923083,0.7846153846153783,0.8230769230769255,0.8846153846153868,0.9769230769230717,1.0153846153846189,1.0230769230769283,1.0,0.9692307692307622,0.8923076923076962,0.8384615384615302,0.8615384615384727,0.815384615384616,0.7692307692307594,0.815384615384616,0.8692307692307679,0.8461538461538538,0.7846153846153783,0.8692307692307679,1.0076923076923094,0.8615384615384585,0.9000000000000057,0.9384615384615387,0.8846153846153868,1.0,1.0461538461538424,0.9923076923076906,1.0153846153846189,1.038461538461533,0.961538461538467,0.9384615384615387,0.9153846153846104,0.8692307692307679,0.923076923076934,1.0,0.9769230769230717,0.9692307692307764,0.9692307692307622,0.9538461538461576,1.0461538461538424,1.0153846153846189,1.0461538461538424,0.9846153846153811,0.8923076923076962,0.8923076923076962,0.8846153846153868,0.8461538461538396,0.9461538461538481,0.9692307692307622,0.8461538461538538,0.8384615384615444,0.7999999999999972,0.7769230769230688,0.8307692307692349,1.0153846153846189,0.9615384615384528,0.9923076923077048,1.0461538461538424,0.9538461538461576,0.853846153846149,0.8076923076922924,0.776923076923083,0.7461538461538453,0.8000000000000114,0.8692307692307679,0.8384615384615302,0.853846153846149,0.9461538461538623,0.9000000000000057,0.9153846153845961,0.9692307692307907,0.8846153846153868,0.853846153846149,0.8230769230769113,0.7846153846153925,0.7692307692307736,0.8307692307692207,0.8846153846153868,0.8615384615384585,0.8230769230769113,0.8384615384615586,0.7923076923076735,0.7538461538461547,0.7615384615384642,0.7692307692307736,0.7461538461538453,0.7153846153846075,0.7307692307692548,0.7307692307692264,0.7461538461538453,0.7461538461538453,0.799999999999983,0.9384615384615529,0.9692307692307622,0.9384615384615529,0.9846153846153811,1.0230769230769283,1.0307692307692093,0.9692307692307907,0.9846153846153811,0.9846153846153811,0.9538461538461434,0.9769230769230717,0.9307692307692434,0.8230769230769113,0.8846153846153868,0.8692307692307679,0.8076923076923208,0.9692307692307622,1.1615384615384698,1.0076923076923094,1.0846153846153754,1.0076923076923094,0.9615384615384528,0.9153846153846246,0.8076923076923208,0.7615384615384642,0.7384615384615358,0.7692307692307452,0.8538461538461775,1.0307692307692093,0.9076923076923151,0.9000000000000057,1.0230769230769283,1.0153846153846189,0.9769230769230717,1.0307692307692378,1.0538461538461377,1.0461538461538566,1.061538461538447,0.9923076923076906,0.9153846153846246,0.776923076923083,0.7923076923076735,0.8384615384615586,0.8384615384615302,0.8000000000000114,0.8461538461538396,0.9538461538461434,0.9769230769230717,0.8615384615384869,0.799999999999983,0.7461538461538453,0.723076923076917,0.6923076923077076,0.7153846153846075,0.7153846153846075,0.7615384615384642,0.8384615384615586,0.8461538461538396,0.8307692307692207,0.7692307692307736,0.7692307692307736,0.8000000000000114,0.9076923076922867,0.9461538461538623,0.8307692307692207,0.8153846153846303,0.8615384615384585,1.0,0.9076923076922867,0.9153846153846246,0.9307692307692434,0.9153846153845961,1.053846153846166,1.1230769230769226,1.0384615384615472,1.130769230769232,1.0692307692307566,0.9923076923076906,0.9307692307692434,0.9153846153845961,0.8923076923076962,0.8076923076923208,0.8384615384615302,0.9000000000000057,0.9000000000000057,0.8230769230769113,0.8923076923076962,0.9230769230769056,0.8384615384615586,0.8076923076922924,0.9076923076923151,0.9923076923076906,0.9076923076923151,0.9076923076923151,0.8769230769230774,0.7923076923076735,0.776923076923083,0.7384615384615358]

# Get R-peaks series using biosppy
# loaded_ecg = biosppy.signals.ecg.ecg(signal)
# nni = []
# for i in range(len(loaded_ecg[2])-1):
#     nni.append(loaded_ecg[0][loaded_ecg[2][i+1]]-loaded_ecg[0][loaded_ecg[2][i]])

# Compute NNI series
# nni = tools.nn_intervals(rpeaks)

nni_results = hrv(nni = nni,plot_ecg=False, plot_tachogram=False, show=False)
print('prueba')
plt.close('all')
tachogram = tools.tachogram(nni = nni)
psd = fd.welch_psd(nni = nni)

# Frequency Comparisson Plots
comparisson_2D = fd.psd_comparison(nni=nni, duration=120, method='welch')
comparisson_3D = fd.psd_waterfall(nni=nni, duration=120, method='welch')

# Time Comparisson Radar Plot
reference_nni = nni
comparison_nni = [0.8846153846153846,1.0076923076923074,1.0,0.9384615384615387,1.0076923076923077,1.0076923076923077,0.976923076923077,0.9999999999999991,0.976923076923077,0.8923076923076927,0.8769230769230774,0.9153846153846139,0.8769230769230774,0.884615384615385,0.9384615384615387,0.9230769230769234,0.9538461538461522,0.9923076923076941,0.9769230769230752,1.0,1.0,0.953846153846154,0.9615384615384635,0.9692307692307658,0.9384615384615387,0.9000000000000021,0.9461538461538446,0.9384615384615387,0.9230769230769234,1.0153846153846153,0.9923076923076941,0.9461538461538446,1.0076923076923059,1.0,1.0,1.0153846153846189,0.9615384615384599,0.9692307692307693,0.9615384615384599,0.9384615384615387,0.9230769230769269,0.9923076923076906,0.9692307692307693,0.8999999999999986,0.9230769230769198,0.9307692307692363,0.907692307692308,0.9307692307692292,0.9538461538461505,0.9230769230769269,0.9615384615384599,1.0230769230769212,0.9153846153846175,0.9153846153846175,0.9230769230769198,0.9384615384615387,0.907692307692308,0.9307692307692292,0.9538461538461576,0.946153846153841,0.9384615384615387,0.9692307692307693,0.9384615384615387,0.9153846153846175,0.9384615384615387,0.907692307692308,0.8692307692307679,0.9230769230769198,1.0846153846153896,1.038461538461533,1.0230769230769283,1.0230769230769283,0.9384615384615245,0.9000000000000057,0.8923076923076962,0.8461538461538396,0.7692307692307736,0.815384615384616,0.8461538461538396,0.8230769230769255,0.7999999999999972,0.8538461538461632,0.8692307692307679,0.8461538461538396,0.9384615384615387,0.9769230769230859,0.9076923076923009,0.8923076923076962,0.8846153846153868,0.8461538461538396,0.7999999999999972,0.8230769230769255,0.815384615384616,0.8076923076923066,0.8076923076923066,0.8538461538461632,0.8615384615384585,0.8384615384615302,0.9153846153846246,0.9076923076923009,0.8692307692307679,0.9153846153846246,0.9692307692307622,0.9538461538461576,0.9384615384615387,0.9076923076923009,0.815384615384616,0.7615384615384642,0.7692307692307736,0.9307692307692292,0.8999999999999915,0.9769230769230859,1.0461538461538424,0.9769230769230717,0.961538461538467,0.9769230769230717,0.9153846153846246,0.892307692307682,0.9000000000000057,0.8769230769230774,0.8384615384615444,0.8230769230769113,0.8076923076923208,0.76153846153845,0.8076923076923066,0.8692307692307821,0.8153846153846018,0.7923076923077019,0.8230769230769255,0.8769230769230774,0.8230769230769113,0.8615384615384727,0.8769230769230774,0.7692307692307594,0.7923076923077019,0.8307692307692207,0.8692307692307679,0.8384615384615444,0.9461538461538481,1.0076923076922952,0.9692307692307907,0.9538461538461434,0.923076923076934,0.8615384615384585,0.8384615384615302,0.8461538461538396,0.8384615384615302,0.8076923076923208,0.8846153846153868,0.9153846153846246,0.8615384615384585,0.8769230769230774,0.9000000000000057,0.8923076923076678,0.8692307692307679,0.923076923076934,0.8692307692307679,0.8307692307692207,0.8384615384615586,0.7769230769230546,0.8000000000000114,0.9384615384615529,0.9615384615384528,0.9461538461538339,1.0,1.0,0.9769230769230717,0.9615384615384812,0.930769230769215,0.9076923076923151,0.8692307692307679,0.7461538461538453,0.7384615384615358,0.7153846153846359,0.7153846153846075,0.7307692307692264,0.776923076923083,1.1153846153846132,1.0153846153846189,1.0923076923076849,1.0461538461538566,1.0153846153845905,1.053846153846166,1.0230769230769283,1.0153846153846189,1.0076923076923094,0.9461538461538339,0.8923076923076962,0.8923076923076962,0.9153846153845961,0.8153846153846303,0.8307692307692207,0.9000000000000057,0.9153846153846246,0.8384615384615302,0.923076923076934,1.0692307692307566,0.9846153846153811,1.0,1.0153846153846189,0.9461538461538623,0.930769230769215,0.9461538461538623,0.9153846153845961,0.8461538461538396,0.9384615384615529,0.9769230769230717,0.9769230769230717,1.0615384615384755,1.0230769230769283,0.9692307692307622,1.0,0.9692307692307622,0.9615384615384528,0.9846153846154095,0.9230769230769056,0.9769230769230717,0.9615384615384812,0.9230769230769056,0.9461538461538623,0.9769230769230717,0.9230769230769056,0.9384615384615529,0.9538461538461434,0.9076923076923151,0.923076923076934,1.0230769230769,0.9846153846154095,0.9846153846153811,0.9615384615384528,0.9000000000000057,0.9230769230769056,0.9384615384615529,0.9000000000000057,0.8461538461538396,0.8692307692307679,0.853846153846149,0.8076923076923208,0.8384615384615302,1.0,1.061538461538447,1.0153846153846189,0.9769230769231001,0.9846153846153811,0.9923076923076906,0.9538461538461434,0.9384615384615529,0.9076923076922867,0.8769230769230774,0.9076923076923151,0.923076923076934,0.8999999999999773,0.9153846153846246,0.9692307692307622,0.9153846153846246,0.9307692307692434,0.9615384615384528,0.930769230769215,0.9307692307692434,0.9384615384615529,0.8999999999999773,0.853846153846149,0.8538461538461775]
params = ['nni_mean', 'sdnn', 'rmssd', 'nn50', 'nn20']
comparisson_radar = tools.radar_chart(nni = reference_nni, comparison_nni=comparison_nni, parameters=params)
print(nni_results)